---
output: html_document
editor_options:
  chunk_output_type: console
---

# Portfolios

```{r}
#| label: setup
#| output: false

source(here::here("report", "_common.R"))

```

## Construct portfolios from ACLI results

Get Gang's weights

+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
|                                                                                  | \                                                             | Portfolio 1 (mimicking private DB pension in 2021); 29.6% equity | Portfolio 2 (mimicking public DB pension in 2021); 48.71% equity |
|                                                                                  | Equivalent asset class(es)                                    |                                                                  |                                                                  |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| aggr                                                                             | Emerging Markets, NASDAQ, Hang Seng                           | 15.0                                                             | 30.1                                                             |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| balanced                                                                         | 60% Diversified Equity + 40% Fixed Income                     | 22.9                                                             | 21.3                                                             |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| fixed                                                                            | 65% Intermediate term govt bond + 35 long term corporate bond | 10.4                                                             | 4.3                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| hy                                                                               | High Yield US corporate bonds                                 | 10.4                                                             | 4.3                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| ig_1_5                                                                           | Intermediate term corporate bonds                             | 10.4                                                             | 4.3                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| ig_long                                                                          | Long term corporate bonds                                     | 13.3                                                             | 6.4                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| int                                                                              | International equity                                          | 5.9                                                              | 9.7                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| small                                                                            | US Small Cap                                                  | 5.9                                                              | 9.7                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| us                                                                               | US Big Cap                                                    | 5.9                                                              | 9.7                                                              |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| No cash/money market, No real estate, No commodities, No Alternative investments |                                                               |                                                                  |                                                                  |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+
| Total                                                                            |                                                               | 100.0                                                            | 100.0                                                            |
+----------------------------------------------------------------------------------+---------------------------------------------------------------+------------------------------------------------------------------+------------------------------------------------------------------+

![](images/clipboard-1522846233.png)

![](images/clipboard-528079377.png)

```{r}
#| label: weights

weights1 <- read_delim(
"fnbase;label;highfixed;highequity
aggr;Emerging Markets, NASDAQ, Hang Seng;15.0;30.1
balanced;60% Diversified Equity + 40% Fixed Income;22.9;21.3
fixed;65% Intermediate term govt bond + 35 long term corporate bond;10.4;4.3
hy;High Yield US corporate bonds;10.4;4.3
ig_1_5;Intermedate term corporate bonds;10.4;4.3
ig_long;Long term corporate bonds;13.3;6.4
int;International equity;5.9;9.7
small;US Small Cap;5.9;9.7
us;US Big Cap;5.9;9.7
", delim=";")

weights1 |> 
  summarise(across(c(highfixed, highequity), sum))

weights <- weights1 |>
  pivot_longer(-c(fnbase, label), names_to = "porttype", values_to = "weight") |> 
  mutate(weight=weight / sum(weight), .by=porttype)

weights |> 
  summarise(weight=sum(weight), .by=porttype)


```

```{r}

slong <- readRDS(here::here("data", "acli_scenarios.rds"))

wtdslong <- slong |> 
  left_join(weights, by = join_by(fnbase),
            relationship = "many-to-many")

portfolios <- wtdslong |> 
  mutate(portvalue=value * weight) |> 
  summarise(value=sum(value), .by=c(scenario, sim, year, porttype))
  
portfolios <- wtdslong |> 
  mutate(retshare=return * weight) |> 
  summarise(wtdreturn=sum(retshare), .by=c(scenario, sim, year, porttype))

portfolios2 <- portfolios |> 
  mutate(wtdreturn=ifelse(year==0, 0, wtdreturn)) |> 
  arrange(scenario, porttype, sim, year) |> 
  mutate(value=cumprod(1 + wtdreturn), .by=c(scenario, sim, porttype))

y30 <- portfolios2 |> 
  filter(year==30) |> 
  summarise(value=median(value), .by=c(scenario, porttype))
  
y30 |> arrange(desc(value))

saveRDS(portfolios2, here::here("data", "acli_portfolios.rds"))


```
